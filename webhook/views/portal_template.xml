<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id = "portal_layout_inherit"
              inherit_id = "portal.portal_layout">
        <xpath expr="//div[@class='o_portal_my_security mt-3']" position="after">
            <div class = "o_portal_my_webhooks mt-3">
                <h4>Webhooks</h4>
                <hr class="mt-1 mb-1"/>
                <a href="/my/webhook/"><i class="fa fa-pencil mx-1"/>Manage Webhooks</a>
            </div>
        </xpath>
    </template>

    <template id = "portal_my_webhook">
        <t t-call = "portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <ul class="nav">
                    <a class="nav-item ">
                        <a class="nav-link active o_portal_new_subscription" href="#">Add</a>
                    </a>
                    <a class="nav-item">
                        <a class="nav-link o_portal_webhook_delete_subscription" href="#">Delete</a>
                    </a>
                </ul>
            </t>

        <div t-attf-class="table-responsive border rounded border-top-0">
            <table class="table rounded mb-0 bg-white o_portal_my_doc_table">
                <t t-out="0"/>
                <thead>
                    <tr class="active">
                        <th><input type="checkbox" id="checkAll" class = "o_portal_webhook_select_all" aria-label="Check webhooks"/></th>
                        <th class="text-left">Event</th>
                        <th class="col-6">URL</th>
                        <th>Description</th>
                        <th class = "text-center">Created on</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach = "request.env.user.webhook_subscriptions" t-as = "webhook_subscription">
                        <td><input type="checkbox" class="checkbox" aria-label="Check webhooks" t-att-id="webhook_subscription.id"/></td>
                        <td class="text-left">
                                <a href = "#" t-att-id="webhook_subscription.id" role = "button" class = "btn-link o_portal_edit_subscription" t-esc="webhook_subscription.webhook.name"/>
                        </td>
                        <td><span t-field="webhook_subscription.webhook_url"/></td>
                        <td><span t-field="webhook_subscription.description"/></td>
                        <td class = "text-center w-200"><a t-field="webhook_subscription.create_date"/></td>
                        <td><a class="nav-link o_portal_webhook_view_logs" role = "button" href="#" t-att-id="webhook_subscription.id">View logs</a></td>
                    </tr>
                </tbody>
            </table>
        </div>
        </t>
    </template>

    <template id = "webhook.webhook_documentation">
        <t t-call = "website.layout">
            <div class = "container-fluid d-flex justify-content-center align-items-center" id = "container" style = "flex-direction: column; height: auto; padding: 2rem ">
                <div class = "mb-3 text-left" id = "header" style = "flex-direction: column; width:60%;height:auto;">
                    <h1 class = "display-4 text-weight-bold" style = "color:#7A436B">Webhook Overview</h1>
                    <a>Webhooks are “user-defined HTTP callbacks.” They are usually triggered by some event, such as pushing code to a repository or a comment posted to a blog. When that event occurs, the source site makes an HTTP request to the URL configured for the webhook. Users can configure them to cause events on one site to invoke behavior on another. ( according to  wikipedia )</a>
                    <a style = "font-size:12px">See available <a href="/webhook/events" target = "_blank" style = "font-size:12px">webhook events</a></a>
                </div>
                <div style = "flex-direction: column; width:60%;height:auto;">
                    <section id = "webhook_events">
                        <h2>Webhook Events</h2>
                        <tr t-foreach="request.env['base.automation'].sudo().search([('is_webhook','=',True)])" t-as="webhook">
                            <div t-attf-id = "collapse{{webhook.id}}" class = "d-flex justify-content-center align-items-center" style = "flex-direction: column; width:100%;height:auto;">
                                <button class ="btn bg-primary pl-3 mb-2 text-left" style = "width:100%; height : 50px;"
                                   type="button" data-toggle="collapse" t-attf-data-target="{{'#'}}collapse-body-{{webhook.id}}"
                                    t-attf-aria-controls = "collapse-body-{{webhook.id}}"
                                        aria-expanded = "false">
                                    <span t-field = "webhook.name"/>
                                </button>
                            </div>
                            <div class = "collapse" t-attf-id = "collapse-body-{{webhook.id}}" style = "width:100%; height : auto ; ">
                                <div class = "card card-body mb-2" >
                                    <div>
                                        <table class = "table table-responsive">
                                            <tbody>
                                                <tr>
                                                    <td>ID</td>
                                                    <td><span t-esc="webhook.id"/></td>
                                                </tr>
                                                <tr>
                                                    <td>Model</td>
                                                    <td><span t-esc="webhook.model_id.name"/></td>
                                                </tr>
                                                <tr>
                                                    <td>Endpoint</td>
                                                    <td><a t-attf-href="/api/documentation?endpoint_id={{webhook.endpoint.id}}#collapse{{webhook.endpoint.id}}" target = "_blank"><t t-esc="webhook.endpoint.name"></t></a></td>
                                                </tr>
                                                <tr>
                                                    <td>Trigger</td>
                                                    <td><span t-esc="webhook.trigger"/></td>
                                                </tr>
                                                <tr>
                                                    <td>Trigger Fields</td>
                                                    <td>
                                                        <t t-foreach="webhook.trigger_field_ids" t-as = "trigger_field_id">
                                                            <a t-esc="trigger_field_id.name"/>
                                                        </t>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Before update domain</td>
                                                    <td><t t-esc="webhook.filter_pre_domain"></t></td>
                                                </tr>
                                                <tr>
                                                    <td>Domain Filter</td>
                                                    <td><t t-esc="webhook.filter_domain"></t></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </tr>
                    </section>
                    <div id = "webhook_subscription">
                        <h2>Subscribe to a webhook event</h2>
                        <span>There are two possible ways to subscribe to a webhook event.</span>
                        <ul>
                            <li>1. Subscribe via UI</li>
                            <li>2. Subscribe via API</li>
                        </ul>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>